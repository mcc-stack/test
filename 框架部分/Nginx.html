<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Nginx | 533实验室Java后端知识点整理</title>
    <meta name="generator" content="VuePress 1.5.4">
    
    <meta name="description" content="533实验室Java后端知识点整理">
    <link rel="preload" href="/test/assets/css/0.styles.363e3238.css" as="style"><link rel="preload" href="/test/assets/js/app.fb04842c.js" as="script"><link rel="preload" href="/test/assets/js/2.275389a7.js" as="script"><link rel="preload" href="/test/assets/js/8.25a2093a.js" as="script"><link rel="prefetch" href="/test/assets/js/10.d306dbdb.js"><link rel="prefetch" href="/test/assets/js/11.3cb03267.js"><link rel="prefetch" href="/test/assets/js/12.913d7c94.js"><link rel="prefetch" href="/test/assets/js/13.888020c4.js"><link rel="prefetch" href="/test/assets/js/14.aa2ced95.js"><link rel="prefetch" href="/test/assets/js/15.17131c71.js"><link rel="prefetch" href="/test/assets/js/16.09c5f2c9.js"><link rel="prefetch" href="/test/assets/js/17.b5fb47e1.js"><link rel="prefetch" href="/test/assets/js/18.a85f24aa.js"><link rel="prefetch" href="/test/assets/js/19.e62c702b.js"><link rel="prefetch" href="/test/assets/js/20.de5fd22c.js"><link rel="prefetch" href="/test/assets/js/21.43f72dd9.js"><link rel="prefetch" href="/test/assets/js/22.ea2b70ef.js"><link rel="prefetch" href="/test/assets/js/23.0dbebaf7.js"><link rel="prefetch" href="/test/assets/js/24.37c84f01.js"><link rel="prefetch" href="/test/assets/js/25.1104c8a2.js"><link rel="prefetch" href="/test/assets/js/3.44c5d363.js"><link rel="prefetch" href="/test/assets/js/4.a42ed78f.js"><link rel="prefetch" href="/test/assets/js/5.5558f3f5.js"><link rel="prefetch" href="/test/assets/js/6.af04c27c.js"><link rel="prefetch" href="/test/assets/js/7.dc65d060.js"><link rel="prefetch" href="/test/assets/js/9.2e34f20e.js">
    <link rel="stylesheet" href="/test/assets/css/0.styles.363e3238.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/test/" class="home-link router-link-active"><!----> <span class="site-name">533实验室Java后端知识点整理</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/test/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="https://github.com/lamarsan" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/test/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="https://github.com/lamarsan" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>基础部分</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>框架部分</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/test/框架部分/Spring5.html" class="sidebar-link">Spring5</a></li><li><a href="/test/框架部分/SpringBoot.html" class="sidebar-link">SpringBoot</a></li><li><a href="/test/框架部分/MyBatis.html" class="sidebar-link">MyBatis</a></li><li><a href="/test/框架部分/Netty.html" class="sidebar-link">Netty</a></li><li><a href="/test/框架部分/Nginx.html" class="active sidebar-link">Nginx</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/test/框架部分/Nginx.html#功能" class="sidebar-link">功能</a></li><li class="sidebar-sub-header"><a href="/test/框架部分/Nginx.html#常用命令" class="sidebar-link">常用命令</a></li><li class="sidebar-sub-header"><a href="/test/框架部分/Nginx.html#进程模型" class="sidebar-link">进程模型</a></li><li class="sidebar-sub-header"><a href="/test/框架部分/Nginx.html#nginx-处理-http-请求的过程" class="sidebar-link">Nginx 处理 Http 请求的过程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/test/框架部分/Nginx.html#reactor" class="sidebar-link">Reactor</a></li></ul></li><li class="sidebar-sub-header"><a href="/test/框架部分/Nginx.html#正反向代理" class="sidebar-link">正反向代理</a></li><li class="sidebar-sub-header"><a href="/test/框架部分/Nginx.html#负载均衡" class="sidebar-link">负载均衡</a></li><li class="sidebar-sub-header"><a href="/test/框架部分/Nginx.html#配置文件结构" class="sidebar-link">配置文件结构</a></li><li class="sidebar-sub-header"><a href="/test/框架部分/Nginx.html#location-规则" class="sidebar-link">location 规则</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/test/框架部分/Nginx.html#匹配" class="sidebar-link">=匹配</a></li><li class="sidebar-sub-header"><a href="/test/框架部分/Nginx.html#匹配-2" class="sidebar-link">~匹配</a></li><li class="sidebar-sub-header"><a href="/test/框架部分/Nginx.html#匹配-3" class="sidebar-link">^~匹配</a></li><li class="sidebar-sub-header"><a href="/test/框架部分/Nginx.html#普通匹配" class="sidebar-link">普通匹配</a></li></ul></li><li class="sidebar-sub-header"><a href="/test/框架部分/Nginx.html#rewrite-的使用" class="sidebar-link">Rewrite 的使用</a></li><li class="sidebar-sub-header"><a href="/test/框架部分/Nginx.html#动静分离与-expires-缓存" class="sidebar-link">动静分离与 Expires（缓存）</a></li><li class="sidebar-sub-header"><a href="/test/框架部分/Nginx.html#跨域配置" class="sidebar-link">跨域配置</a></li><li class="sidebar-sub-header"><a href="/test/框架部分/Nginx.html#gzip-压缩策略" class="sidebar-link">gzip 压缩策略</a></li></ul></li><li><a href="/test/框架部分/消息中间件.html" class="sidebar-link">消息中间件</a></li><li><a href="/test/框架部分/Docker.html" class="sidebar-link">Docker</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>算法</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>大数据</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>项目</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="nginx"><a href="#nginx" class="header-anchor">#</a> Nginx</h1> <p>Nginx 是一个高性能的 HTTP 和反向代理服务器，及电子邮件代理服务器。</p> <h2 id="功能"><a href="#功能" class="header-anchor">#</a> 功能</h2> <ul><li><p>反向代理</p></li> <li><p>负载均衡</p></li> <li><p>动静分离</p></li></ul> <h2 id="常用命令"><a href="#常用命令" class="header-anchor">#</a> 常用命令</h2> <p>启动命令： <code>./sbin/nginx -c conf/nginx.conf</code></p> <p>停止命令：<code>./sbin/nginx -s stop</code></p> <p>​ <code>./sbin/nginx -s quit</code></p> <p>重载配置：<code>./sbin/nginx -s reload</code>(平滑重启)</p> <h2 id="进程模型"><a href="#进程模型" class="header-anchor">#</a> 进程模型</h2> <p><img src="/test/assets/img/image-20200213223116000.e5de0931.png" alt="image-20200213223116000"></p> <p>Nginx 启动时分为单进程模式和多进程模式，在多进程模式下，有一个 master 进程多个 worker 进程，其中，master 进程负责信号处理以及 worker 进程的管理；worker 进程负责处理具体的请求。Master 与 Worker 中间使用 epoll 多路复用来确保非阻塞。</p> <p>基于此，Nginx 得以无缝重启，在重启时，master 并不会重启，只是更换了 Worker 进程（Worker 是单线程的）。</p> <h2 id="nginx-处理-http-请求的过程"><a href="#nginx-处理-http-请求的过程" class="header-anchor">#</a> Nginx 处理 Http 请求的过程</h2> <p>Nginx 使用 Reactor 模式。主进程循环等待操作系统发出准备事件的信号，这样数据就可以从套接字读取，在该实例中读取到缓冲区并进行处理。单个线程可以提供数万个并发连接。</p> <h3 id="reactor"><a href="#reactor" class="header-anchor">#</a> Reactor</h3> <p>Reactor 模式是事件驱动的一种实现方式，处理多个客户端并发的向服务端请求服务的场景。</p> <p><img src="/test/assets/img/image-20200214002028329.3708ed68.png" alt="image-20200214002028329"></p> <p>这是最简单的单 Reactor 单线程模型。Reactor 线程是个多面手，负责多路分离套接字，Accept 新连接，并分派请求到 Handler 处理器中。</p> <h2 id="正反向代理"><a href="#正反向代理" class="header-anchor">#</a> 正反向代理</h2> <ul><li><p>正向代理</p> <p>正向代理就是平时说的代理（比如 Shadowsocks 就是正向代理），是指 Nginx 代理服务器受<strong>客户端</strong>委托代理客户端，转发请求，并将从服务端获得的响应返回给客户端。</p></li> <li><p>反向代理</p> <p>反向代理是指 Nginx 代理服务器受<strong>服务端</strong>的委托代理服务端，作为集群的 web 节点，反向代理一般和负载均衡配合使用。反向代理服务器可以隐藏源服务器的存在和特征，比较安全。</p></li></ul> <h2 id="负载均衡"><a href="#负载均衡" class="header-anchor">#</a> 负载均衡</h2> <p>负载均衡的实现必须依赖于反向代理，Nginx 的负载均衡策略有两种：内置策略和扩展策略。</p> <p>内置策略：</p> <ul><li>轮询：将请求依次轮询发给每个服务器。</li> <li>最少连接：将请求发送给持有最少活动链接的服务器。（least_conn)</li> <li>IP 哈希：通过哈希函数决定请求发送给哪个服务器。（ip_hash）</li> <li>权重：服务器的权重越高，处理请求的概率越大。</li></ul> <h2 id="配置文件结构"><a href="#配置文件结构" class="header-anchor">#</a> 配置文件结构</h2> <ul><li><p>全局块</p> <p>一般配置影响 Nginx 全局的指令。一般配置用户组，日志存放路径，pid 存放路径等。</p></li> <li><p>events 块</p> <p>配置 Nginx 服务器与用户的网络连接。</p> <div class="language-shell extra-class"><pre class="language-shell"><code>events <span class="token punctuation">{</span>
    worker_connections  <span class="token number">1024</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>http 块</p> <p>可以嵌套多个 server 块，配置代理服务器，日志等。</p> <ul><li><p>server 块</p> <p>可以嵌套多个 location 块，配置代理服务器的相关参数。</p> <div class="language-shell extra-class"><pre class="language-shell"><code>upstream aaa<span class="token punctuation">{</span>
	<span class="token comment"># 反向代理</span>
	server <span class="token number">127.0</span>.0.1:8080 <span class="token assign-left variable">weight</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
	server <span class="token number">127.0</span>.0.1:8081 <span class="token assign-left variable">weight</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

server<span class="token punctuation">{</span>
	listen <span class="token number">80</span><span class="token punctuation">;</span>

	<span class="token punctuation">..</span>.

	location / <span class="token punctuation">{</span>
		proxy_pass http://aaa<span class="token punctuation">;</span>

		<span class="token punctuation">..</span>.
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>location 块</p> <p>配置请求路由和处理请求的页面或服务器。</p></li></ul></li></ul> <h2 id="location-规则"><a href="#location-规则" class="header-anchor">#</a> location 规则</h2> <table><thead><tr><th>标识符</th> <th>描述</th></tr></thead> <tbody><tr><td>=</td> <td><strong>精确匹配：</strong> 用于标准 uri 前，要求请求字符串和 uri 严格匹配。如果匹配成功就停止匹配，立即执行该 location 里面的请求。</td></tr> <tr><td>~</td> <td><strong>正则匹配：</strong> 用于正则 uri 前，表示 uri 里面包含正则，并且区分大小写。</td></tr> <tr><td>~*</td> <td><strong>正则匹配：</strong> 用于正则 uri 前，表示 uri 里面包含正则，不区分大小写。</td></tr> <tr><td>^~</td> <td><strong>非正则匹配：</strong> 用于标准 uri 前，Nginx 服务器匹配到前缀最多的 uri 后就结束，该模式匹配成功后，不会使用正则匹配。</td></tr> <tr><td>无</td> <td><strong>普通匹配（最长字符匹配）：</strong> 与 location 顺序无关，是按照匹配的长短来取匹配结果。若完全匹配，就停止匹配。</td></tr></tbody></table> <h3 id="匹配"><a href="#匹配" class="header-anchor">#</a> =匹配</h3> <div class="language-shell extra-class"><pre class="language-shell"><code>location <span class="token operator">=</span> /news/ <span class="token punctuation">{</span>
    <span class="token builtin class-name">echo</span> <span class="token string">&quot;test1&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token punctuation">[</span>root<span class="token punctuation">..</span>.<span class="token punctuation">]</span> <span class="token function">curl</span> x.x.x.x/news/
test1
</code></pre></div><h3 id="匹配-2"><a href="#匹配-2" class="header-anchor">#</a> ~匹配</h3> <div class="language-shell extra-class"><pre class="language-shell"><code>location ~ <span class="token punctuation">\</span>.<span class="token punctuation">(</span>html<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">echo</span> <span class="token string">'test2'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
location ~ <span class="token punctuation">\</span>.<span class="token punctuation">(</span>htmL<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">echo</span> <span class="token string">'test3'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token punctuation">[</span>root<span class="token punctuation">..</span>.<span class="token punctuation">]</span> <span class="token function">curl</span> x.x.x.x/index.html
test2
<span class="token punctuation">[</span>root<span class="token punctuation">..</span>.<span class="token punctuation">]</span> <span class="token function">curl</span> x.x.x.x/index.htmL
test3
</code></pre></div><h3 id="匹配-3"><a href="#匹配-3" class="header-anchor">#</a> ^~匹配</h3> <div class="language-shell extra-class"><pre class="language-shell"><code>location ^~ /index/ <span class="token punctuation">{</span>
    <span class="token builtin class-name">echo</span> <span class="token string">'test5'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token punctuation">[</span>root<span class="token punctuation">..</span>.<span class="token punctuation">]</span> <span class="token function">curl</span> x.x.x.x/index/heihei
test5
</code></pre></div><h3 id="普通匹配"><a href="#普通匹配" class="header-anchor">#</a> 普通匹配</h3> <div class="language-shell extra-class"><pre class="language-shell"><code>location / <span class="token punctuation">{</span>
    <span class="token builtin class-name">echo</span> <span class="token string">'test6'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token punctuation">[</span>root<span class="token punctuation">..</span>.<span class="token punctuation">]</span> <span class="token function">curl</span> x.x.x.x
test6
</code></pre></div><h2 id="rewrite-的使用"><a href="#rewrite-的使用" class="header-anchor">#</a> Rewrite 的使用</h2> <p>基本语法：<code>if(condition){...}</code></p> <table><thead><tr><th>标记符号</th> <th>说明</th></tr></thead> <tbody><tr><td>last</td> <td>终止在本 location 块中处理接收到的 URI，并将此处重写的 URI 作为新的 URI 使用其他 location 进行处理。（只是终止当前 location 的处理）</td></tr> <tr><td>break</td> <td>将此处重写的 URI 作为一个新的 URI 在当前 location 中继续执行，并不会将新的 URI 转向其他 location。</td></tr> <tr><td>redirect</td> <td>将重写后的 URI 返回个客户端，状态码是 302，表明临时重定向，主要用在 replacement 字符串不以“http://”，“ https://”或“ $scheme” 开头；</td></tr> <tr><td>permanent</td> <td>将重写的 URI 返回客户端，状态码为 301，指明是永久重定向；</td></tr></tbody></table> <p>例子：</p> <div class="language-shell extra-class"><pre class="language-shell"><code>server <span class="token punctuation">{</span>
    listen <span class="token number">80</span><span class="token punctuation">;</span>
    server_name   abc.com<span class="token punctuation">;</span>
    rewrite   ^/<span class="token punctuation">(</span>.*<span class="token punctuation">)</span>    http://www.abc.com/<span class="token variable">$1</span> permanent<span class="token punctuation">;</span>  <span class="token comment"># 跳转到www.abc.com网址上</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="动静分离与-expires-缓存"><a href="#动静分离与-expires-缓存" class="header-anchor">#</a> 动静分离与 Expires（缓存）</h2> <p>动静分离是让动态网站里的动态网页根据一定规则把不变的资源和经常变的资源区分开来，动静资源做好了拆分以后，我们就可以根据静态资源的特点将其做缓存操作，这就是网站静态化处理的核心思路。</p> <p>以下代码同时配置了静态资源的访问与缓存策略：</p> <p><img src="/test/assets/img/image-20200214003013275.58f3c167.png" alt="image-20200214003013275"></p> <h2 id="跨域配置"><a href="#跨域配置" class="header-anchor">#</a> 跨域配置</h2> <p>跨域的概念：</p> <p>浏览器从一个域名的网页去请求另一个域名的资源时，域名、端口、协议任一不同，都是跨域。</p> <p>参考配置代码：</p> <div class="language-shell extra-class"><pre class="language-shell"><code>location /xxx-web <span class="token punctuation">{</span>
	add_header <span class="token string">'Access-Control-Allow-Origin'</span> <span class="token variable">$http_origin</span><span class="token punctuation">;</span>
	add_header <span class="token string">'Access-Control-Allow-Credentials'</span> <span class="token string">'true'</span><span class="token punctuation">;</span>
	add_header <span class="token string">'Access-Control-Allow-Methods'</span> <span class="token string">'GET, POST, OPTIONS'</span><span class="token punctuation">;</span>
	add_header <span class="token string">'Access-Control-Allow-Headers'</span> <span class="token string">'DNT,web-token,app-token,Authorization,Accept,Origin,Keep-Alive,User-Agent,X-Mx-ReqToken,X-Data-Type,X-Auth-Token,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range'</span><span class="token punctuation">;</span>
	add_header <span class="token string">'Access-Control-Expose-Headers'</span> <span class="token string">'Content-Length,Content-Range'</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$request_method</span> <span class="token operator">=</span> <span class="token string">'OPTIONS'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		add_header <span class="token string">'Access-Control-Max-Age'</span> <span class="token number">1728000</span><span class="token punctuation">;</span>
		add_header <span class="token string">'Content-Type'</span> <span class="token string">'text/plain; charset=utf-8'</span><span class="token punctuation">;</span>
		add_header <span class="token string">'Content-Length'</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token builtin class-name">return</span> <span class="token number">204</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	root   html<span class="token punctuation">;</span>
	index  index.html index.htm<span class="token punctuation">;</span>
	proxy_pass http://127.0.0.1:8080<span class="token punctuation">;</span>
	proxy_set_header Host <span class="token variable">$host</span><span class="token punctuation">;</span>
	proxy_set_header X-Real-IP <span class="token variable">$remote_addr</span><span class="token punctuation">;</span>
	proxy_set_header X-Forwarded-For <span class="token variable">$proxy_add_x_forwarded_for</span><span class="token punctuation">;</span>
	proxy_set_header X-Forwarded-Proto <span class="token variable">$scheme</span><span class="token punctuation">;</span>
	proxy_connect_timeout <span class="token number">5</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ol><li><p>Access-Control-Allow-Origin，这里使用变量 $http_origin 取得当前来源域。</p></li> <li><p>Access-Control-Allow-Credentials，为 true 的时候指请求时可带上 Cookie，自己按情况配置。</p></li> <li><p>Access-Control-Allow-Methods，OPTIONS 一定要有的，另外一般也就 GET 和 POST，如果你有其它的也可加进去；</p></li> <li><p>Access-Control-Allow-Headers，这个要注意，里面一定要包含自定义的 http 头字段（就是说前端请求接口时，如果在 http 头里加了自定义的字段，这里配置一定要写上相应的字段）。</p></li> <li><p>Access-Control-Expose-Headers，可不设置，看网上大致意思是默认只能获返回头的 6 个基本字段，要获取其它额外的，先在这设置才能获取它；</p></li> <li><p>语句“ if ($request_method = 'OPTIONS') { ”，因为浏览器判断是否允许跨域时会先往后端发一个 options 请求，然后根据返回的结果判断是否允许跨域请求，所以这里单独判断这个请求，然后直接返回。</p></li></ol> <h2 id="gzip-压缩策略"><a href="#gzip-压缩策略" class="header-anchor">#</a> gzip 压缩策略</h2> <p>浏览器请求 url，同时声明当前浏览器可以支持压缩类型（gzip、deflate 等），服务端会把内容根据浏览器所支持的压缩策略去进行压缩并返回给浏览器，浏览器拿到数据以后进行解码。</p> <p><img src="/test/assets/img/image-20200214003031201.f97a9e02.png" alt="image-20200214003031201"></p> <p><img src="/test/assets/img/image-20200214003048549.e832e841.png" alt="image-20200214003048549"></p> <p>Nginx 默认只对 text/html 进行压缩 ，如果要对 html 之外的内容进行压缩传输，需要我们进行手动配置。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/test/框架部分/Netty.html" class="prev">
        Netty
      </a></span> <span class="next"><a href="/test/框架部分/消息中间件.html">
        消息中间件
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/test/assets/js/app.fb04842c.js" defer></script><script src="/test/assets/js/2.275389a7.js" defer></script><script src="/test/assets/js/8.25a2093a.js" defer></script>
  </body>
</html>
